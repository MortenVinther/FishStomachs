<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Example 03: Estimate population diet</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Example 03: Estimate population diet</h1>



<p>This example shows the data compilation of stomach contents observations into population diet after the initial data manipulation have been done (see example 1 and 2). The compilation includes assigning partly identified prey items into known preys, and calculation of the population diet from a weighed mean of the observed data. Both re-distribution of partly identified preys and raising the observation to population mean requires stratification of data in space and time.</p>
<p>First data from the previous data manipulations (“Example 02”) are loaded.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FishStomachs)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(readr))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;ex02.Rdata&quot;</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>s</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Object of class &#39;STOMobs&#39;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ===========================</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of samples: 4104 </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of prey names: 210 </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Years: 1991 </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Changes done</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Prey weights by record done</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Bias corrected, energy contents, armament etc</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Predator size class assigned</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Bias corrected, regurgitated stomachs</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Prey size class assigned</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Aggregate by sample ID and predator and prey size group</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Allocate missing prey length</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>, <span class="at">label=</span><span class="st">&#39;Begin example 3&#39;</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Begin example 3 </span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 1 </span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                             70    100    150    200    250  9999     all</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Aphrodite aculeata          NA     NA     NA     NA     NA 307.2   307.2</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Callionymus lyra         309.3     NA     NA     NA     NA    NA   309.3</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea                      NA   69.0     NA     NA     NA    NA    69.0</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA     NA     NA 2033.8     NA    NA  2033.8</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Corystes cassivelanus       NA     NA     NA     NA     NA  42.6    42.6</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Hippogloss. Platessoides    NA  386.1 1011.9     NA     NA    NA  1398.0</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Limanda limanda           67.5 1279.7 4063.9 2135.2     NA    NA  7546.2</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Macropipus holsatus         NA     NA     NA     NA     NA  31.2    31.2</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus        NA     NA     NA     NA 6504.2    NA  6504.2</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Solea solea                 NA     NA 1579.9     NA     NA    NA  1579.9</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                      376.8 1734.8 6655.7 4169.0 6504.2 381.0 19821.5</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 4 </span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                        100    200 9999    all</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus         NA 1295.7   NA 1295.7</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii 353.3     NA  0.5  353.8</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                  353.3 1295.7  0.5 1649.5</span></span></code></pre></div>
<div id="group-prey-species" class="section level3">
<h3>Group prey species</h3>
<p>The Multi species model, SMS, groups the prey species into commercial species and a other species, both fish and invertebrates, into “Other food”. For this The NODC system is convenient due to its hierarchical structure. First, the structure for grouping is made input files. Here, data files from the FishStomachs package are used to produce the key (data set NODC_split) to split/aggregate data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;species_info.csv&quot;</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(nodc<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> prey_sp) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(species,nodc)<span class="sc">%&gt;%</span><span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">species_group=</span>species,<span class="at">First=</span>nodc) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Last=</span>First,<span class="at">named=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(a)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   species_group                 First       Last named</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                         &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Gadus morhua             8791030402 8791030402 TRUE </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Merlangius merlangus     8791031801 8791031801 TRUE </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Melanogrammus aeglefinus 8791031301 8791031301 TRUE </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Clupea harengus          8747010201 8747010201 TRUE </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Ammodytidae              8845010000 8845010000 TRUE </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Trisopterus esmarkii     8791031703 8791031703 TRUE</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;other_food_nodc.csv&quot;</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="fu">cols</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">named=</span><span class="cn">FALSE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(b)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 4</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   species_group      First       Last named</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 other          400000000 8499999999 FALSE</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Other fish    8500000000 8747009999 FALSE</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Clupeidae     8747010000 8747019999 FALSE</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Other fish    8747020000 8791029999 FALSE</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Gadidae       8791030000 8791031999 FALSE</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Other fish    8791032000 8999999999 FALSE</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>NODC_split<span class="ot">&lt;-</span><span class="fu">bind_rows</span>(a,b)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>NODC_split</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 14 x 4</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    species_group                 First       Last named</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;                         &lt;dbl&gt;      &lt;dbl&gt; &lt;lgl&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Gadus morhua             8791030402 8791030402 TRUE </span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Merlangius merlangus     8791031801 8791031801 TRUE </span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Melanogrammus aeglefinus 8791031301 8791031301 TRUE </span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Clupea harengus          8747010201 8747010201 TRUE </span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Ammodytidae              8845010000 8845010000 TRUE </span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Trisopterus esmarkii     8791031703 8791031703 TRUE </span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Sprattus sprattus        8747011701 8747011701 TRUE </span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 other                     400000000 8499999999 FALSE</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Other fish               8500000000 8747009999 FALSE</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Clupeidae                8747010000 8747019999 FALSE</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11 Other fish               8747020000 8791029999 FALSE</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12 Gadidae                  8791030000 8791031999 FALSE</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13 Other fish               8791032000 8999999999 FALSE</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 unknown                  9000000000 9999999999 FALSE</span></span></code></pre></div>
<p>The NODC_split data includes the names preys (named=TRUE) that is included in the SMS model. The other group of preys (named=FALSE ) includes other prey groups that not fully species identified or species identified preys which belongs to the group of “other food” where</p>
<ul>
<li>“other” contains the NODC range for invertebrate preys that that will part of the “other food” group in SMS.</li>
<li>“other fish” contains the NODC range for fish preys that is not a names species and not a special group.<br />
</li>
<li>“Clupeidae” includes herring like species (e.g. herring and sprat) that could not be estimated at species level.</li>
<li>“Gadidae” includes cod like species (e.g. cod, whiting) that could not be estimated at species level.</li>
<li>“unknown” includes unidentified remains, both invertebrates and vertebrates.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">group_prey_species</span>(s,<span class="at">NODC_split=</span>NODC_split,<span class="at">show_allocations=</span><span class="cn">FALSE</span> )</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>, <span class="at">label=</span><span class="st">&#39;After group_prey_species&#39;</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  After group_prey_species </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1008 </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 1 </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                         70    100    150    200    250 9999     all</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus         NA     NA     NA 2033.8     NA   NA  2033.8</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae               NA   69.0     NA     NA     NA   NA    69.0</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus    NA     NA     NA     NA 6504.2   NA  6504.2</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                   NA     NA     NA     NA     NA  381   381.0</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish           376.8 1665.8 6655.7 2135.2     NA   NA 10833.5</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                  376.8 1734.8 6655.7 4169.0 6504.2  381 19821.5</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 582 </span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 4 </span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                        100    200 9999    all</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus         NA 1295.7   NA 1295.7</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii 353.3     NA  0.5  353.8</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                  353.3 1295.7  0.5 1649.5</span></span></code></pre></div>
<p>Data are now aggregated in the specified groups, as shown above.</p>
</div>
<div id="aggregation-of-stomach-within-the-same-sample_id-and-predator-size-class" class="section level3">
<h3>Aggregation of stomach within the same sample_Id and predator size class</h3>
<p>The individual stomachs from the same sample Id, predator and prey size classes are aggregated.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">aggregate_within_sample</span>(s)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>s</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Object of class &#39;STOMobs&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ===========================</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of samples: 4104 </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of prey names: 12 </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Years: 1991 </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Changes done</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Prey weights by record done</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Bias corrected, energy contents, armament etc</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Predator size class assigned</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Bias corrected, regurgitated stomachs</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Prey size class assigned</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; TRUE:  Aggregate by sample ID and predator and prey size group</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Temporal and spatial strata added</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Allocate partly identified prey species</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; FALSE: Allocate missing prey length</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>, <span class="at">label=</span><span class="st">&quot;Exampel 2, begins&quot;</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Exampel 2, begins </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 0500-0699 </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 4 </span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA        NA        NA    1295.7        NA</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii        NA     353.3        NA        NA        NA</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                          0     353.3         0    1295.7         0</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      9999-9999    all</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA 1295.7</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii       0.5  353.8</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                        0.5 1649.5</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1000-1499 </span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 1 </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA        NA        NA    2033.8        NA</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                   NA      69.0        NA        NA        NA</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus        NA        NA        NA        NA    6504.2</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                       NA        NA        NA        NA        NA</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish               376.8    1665.8    6655.7    2135.2        NA</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                      376.8    1734.8    6655.7    4169.0    6504.2</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      9999-9999     all</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA  2033.8</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                   NA    69.0</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus        NA  6504.2</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                      381   381.0</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                  NA 10833.5</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                        381 19821.5</span></span></code></pre></div>
<p>The call to  replaces fish_id by the predator size class. In this case there are are only one fish_id within a sample id, so there is no changes except the use of predator and prey size classes.</p>
</div>
<div id="assigning-strata-first-step-in-estimating-population-diet" class="section level3">
<h3>Assigning strata, first step in estimating population diet</h3>
<p>The average diet should basically be calculated as a stratified mean of the individual stomach content samples, weighted by strata abundances (indices) of the predator and strata areas. In this example an average stomach contents is first calculate by ICES rectangles. When there was more than one sample within a rectangle the rectangle value was calculated as the weighted mean of the sample (haul) average values, the weighting factors being the number of stomachs from each sample.</p>
<p>The average stomach contents is then calculated for a larger area which in this case is the ICES roundfish areas consisting of a number of ICES rectangles. The mean strata_area is a weighted average of the The rectangle values were weighted by the mean square root of survey catch rates within the rectangle; this reduces the influence of occasional very large catch rates.</p>
<p>Finally the population diet is calculated from the average roundfish stomach contents weighted by the proportion of the predator population within the roundfish areas.</p>
<p>The temporal stratification is based on year and quarter of the year.</p>
<p>The stratification is specified in the control object to STOMobs as shown below</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#structure and default contents</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">get_control</span>(s),<span class="at">show=</span><span class="fu">c</span>(<span class="st">&#39;Stratification&#39;</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: Stratification</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">edit_control</span>(s,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">strata_area_exp=</span><span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">&#39;R&#39;</span>,area,<span class="at">sep=</span><span class="st">&#39;-&#39;</span>)),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">strata_sub_area_exp=</span><span class="fu">expression</span>(rectangle),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">strata_time_exp=</span><span class="fu">expression</span>(<span class="fu">paste0</span>(year, <span class="st">&quot;-Q&quot;</span>, quarter)),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">strata_year_back=</span><span class="fu">expression</span>(<span class="fu">as.numeric</span>(<span class="fu">substr</span>(stratum_time, <span class="dv">1</span>, <span class="dv">4</span>))),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">strata_quarter_back=</span><span class="fu">expression</span>(<span class="fu">as.numeric</span>(<span class="fu">substr</span>(stratum_time, <span class="dv">7</span>, <span class="dv">8</span>)))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_area_exp type; expression TRUE </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_sub_area_exp type; expression TRUE </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_time_exp type; expression TRUE </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_year_back type; expression TRUE </span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_quarter_back type; expression TRUE</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># to see the changes</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># print(get_control(s),show=c(&#39;stratification&#39;))</span></span></code></pre></div>
<p>The “strata_sub_area_exp” is defined from the STOMobs field rectangle, and the “strata_area” from area (with an “R-” in front). The “strata_time_exp” is defined from the fields year and quarter. Note that definition of strata is provided as as R expression. The “strata_year_back” and “strata_quarter_back” are expression to derive year and quarter from the strata_time variable (used in Example 4)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">add_strata</span>(s)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s,<span class="at">label=</span><span class="st">&#39;After add_strata&#39;</span>, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  After add_strata </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stratum_area: R-1 stratum_sub_area: 50E7 stratum_time: 1991-Q1 sample_id: Gadus morhua_SCO_y:91_q:1_ID:582  fish_id: 0500-0699 </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 4 </span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA        NA        NA    1295.7        NA</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii        NA     353.3        NA        NA        NA</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                          0     353.3         0    1295.7         0</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      9999-9999    all</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA 1295.7</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii       0.5  353.8</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                        0.5 1649.5</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stratum_area: R-7 stratum_sub_area: 40F6 stratum_time: 1991-Q1 sample_id: Gadus morhua_FRA_y:91_q:1_ID:1008  fish_id: 1000-1499 </span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of stomachs (&#39;n_tot&#39;): 1 </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      0070-0099 0100-0149 0150-0199 0200-0249 0250-0299</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA        NA        NA    2033.8        NA</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                   NA      69.0        NA        NA        NA</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus        NA        NA        NA        NA    6504.2</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                       NA        NA        NA        NA        NA</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish               376.8    1665.8    6655.7    2135.2        NA</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                      376.8    1734.8    6655.7    4169.0    6504.2</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      9999-9999     all</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus             NA  2033.8</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                   NA    69.0</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus        NA  6504.2</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                      381   381.0</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                  NA 10833.5</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                        381 19821.5</span></span></code></pre></div>
</div>
<div id="assigning-partly-identified-prey-items-to-identified-preys." class="section level3">
<h3>Assigning partly identified prey items to identified preys.</h3>
<p>Prey items are now names as model preys (named prey from data set NODC_split) or or the unnamed preys “other”, “other food”, “other fish”, “Clupeidae”, “Gadidae” and “unknown”. This assigning of partly identified preys are done using a key (data set “from_to_species.csv below”) and the function .</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>from_to <span class="ot">&lt;-</span><span class="fu">make_from_to_species</span>(<span class="at">inp_file=</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;from_to_species.csv&quot;</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>from_to</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15 x 3</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    order from_species to_species                </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;                     </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1     1 Clupeidae    &quot;Clupea harengus&quot;         </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2     1 Clupeidae    &quot;Sprattus sprattus&quot;       </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3     2 Gadidae      &quot;Gadus morhua&quot;            </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4     2 Gadidae      &quot;Melanogrammus aeglefinus&quot;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5     2 Gadidae      &quot;Merlangius merlangus&quot;    </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6     2 Gadidae      &quot;Trisopterus esmarkii&quot;    </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7     3 unknown      &quot;Ammodytidae&quot;             </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8     3 unknown      &quot;Clupea harengus &quot;        </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9     3 unknown      &quot;Gadus morhua&quot;            </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10     3 unknown      &quot;Melanogrammus aeglefinus&quot;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11     3 unknown      &quot;Merlangius merlangus&quot;    </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12     3 unknown      &quot;other &quot;                  </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13     3 unknown      &quot;Other fish&quot;              </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14     3 unknown      &quot;Sprattus sprattus&quot;       </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15     3 unknown      &quot;Trisopterus esmarkii&quot;</span></span></code></pre></div>
<p>The from_to data specify that first (order=1) preys identified as the group “Clupeidae” must be split into the proportionally to the known prey species <em>Clupea harengus</em> and <em>Sprattus sprattus</em> (if such are identified in the sample). Next (order=2) “Gadidae” is spilt into a range of gadoids. As the third step, “unknown” prey item are split into a range of prey groups, which includes bot named and not named preys. This splitting og preys can be done at different strata level, starting with sample level, sub_area level and area level.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>,<span class="at">use_criteria=</span><span class="cn">FALSE</span>,<span class="at">rel_weight=</span><span class="cn">FALSE</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">label=</span><span class="st">&quot;Before reallocation of unindentified preys&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                37789.3   65079.1   43568.2   27933.5    5724.4</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus              350.3    2322.9   64287.4  156405.0  406105.8</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA    7927.7   19791.4     576.9     845.2</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                     2995.8    9809.7   60141.5   72984.1   44765.6</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                3668.5   17362.4   29349.6   18870.2    6711.5</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus        NA   14381.4  112693.4   79700.4  108661.8</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus         515.8    3866.4  151839.0  164334.1  288049.9</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                 29813.6  107770.7  704249.9  962659.1  296848.9</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus            189.2   17803.7   21235.1        NA        NA</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii        5039.3   95617.6  374028.2  141280.9    2056.9</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA        NA        NA</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                        80361.7  341941.5 1581183.8 1624744.3 1159770.0</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999       all</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                     NA        NA        NA   33523.3  213617.8</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus           175150.3        NA        NA   47045.6  851667.3</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA        NA        NA   10689.6   39830.8</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                    16807.7   14913.5        NA   38121.2  260539.1</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua               10896.1    8615.3   32909.4    2524.3  130907.3</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus   22437.7   11661.3   13597.3   14983.2  378116.5</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus      284229.7   85582.8        NA   55027.6 1033445.3</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA 1085397.8 1085397.8</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                158046.3  173448.8        NA  169167.8 2602005.2</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus               NA        NA        NA     180.7   39408.7</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA   24372.9  642395.7</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA      64.5      64.5</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                       667567.8  294221.7   46506.7 1481098.5 7277396.1</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>,<span class="at">use_criteria=</span><span class="cn">FALSE</span>,<span class="at">rel_weight=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">label=</span><span class="st">&quot;Before reallocation of unindentified preys&quot;</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.1       5.6</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA       0.1       0.3       0.0       0.0</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                        0.0       0.1       0.8       1.0       0.6</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.2       0.4       0.3       0.1</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.5       1.1       1.5</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.1       2.3       4.0</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus              0.0       0.2       0.3        NA        NA</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii           0.1       1.3       5.1       1.9       0.0</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA        NA        NA</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            1.1       4.7      21.7      22.3      15.9</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.6  11.7</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA        NA        NA       0.1   0.5</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                        0.2       0.2        NA       0.5   3.6</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.1       0.5       0.0   1.8</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus       0.3       0.2       0.2       0.2   5.2</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           3.9       1.2        NA       0.8  14.2</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.5</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.3   8.8</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA       0.0   0.0</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            9.2       4.0       0.6      20.4 100.0</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="co"># by sample</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span>sample_id,</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 81,  found: 18   un-allocated: 63</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 439,  found: 217   un-allocated: 222</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>,<span class="at">use_criteria=</span><span class="cn">FALSE</span>,<span class="at">rel_weight=</span><span class="cn">TRUE</span>,</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        <span class="at">label=</span><span class="st">&quot;Before reallocation of unindentified preys&quot;</span>)</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Before reallocation of unindentified preys </span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.2       5.6</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA        NA        NA        NA        NA</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                         NA        NA        NA        NA        NA</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.5       0.3       0.1</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.7       1.1       1.5</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.2       2.3       4.1</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.3        NA        NA</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii           0.1       1.4       5.4       2.0       0.0</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA        NA        NA</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            1.1       4.5      21.2      21.5      15.5</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.6  11.7</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupeidae                       NA        NA        NA       0.5   0.5</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadidae                         NA        NA        NA       2.3   2.3</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.1       0.5       0.0   1.9</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus       0.3       0.2       0.2       0.2   5.4</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           4.0       1.2        NA       0.9  14.7</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.5</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.4   9.2</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; unknown                         NA        NA        NA       0.0   0.0</span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            9.0       3.9       0.6      22.7 100.0</span></span></code></pre></div>
<p>The call to do_detailed_output() is changed such that it shows the full data set (use_criteria=FALSE), all data are aggregated rrespective of predator size and year and quarter ( by_sample_id=TRUE). This setting makes limited sense, however it is made just to follow what happens.</p>
<p>The call to redist_unidentified_prey_sp() is quite complex, so please see help (?redist_unidentified_prey_sp).</p>
<p>The function redistribute partly identified preys to the distribution of the identified prey species from the same predator and predator size. The distribution key is made from an extract of data, which are filtered by the parameters dist_time, dist_area and dist_pred_size. In this example, a unique re-distribution key is made by each combination of stratum_time (year quarter combination), sample_id and predator size class. The by_prey_size=FALSE specifies that prey sizes is not used in the stratification, e.g. a Clupeida size 9999-9999 can be re-distributed to <em>Clupea harengus</em> with known sizes. The do_only=c(1,2) specifies that is only step number 1 and 2 in the from_to that should performed (i.e just redistribution of Clupeidae and Gadidae).</p>
<p>the messages from the redist_unidentified_prey_sp() says that 81 records with prey=Clupeidae were founs, of which 618 could be realloacted to other named Clupeidae species within tha sample, but there are still 63 records where no named Clupeidae species within the sample. The unallocated records are kept as they were as parameter remains_to_other = FALSE. If set to TRUE, the remaining records would have been changed into “other”.</p>
<p>Befor the redistribution, there was Gadidae comprised 3.6 % of the total stomach contents weight. This is reduced to 2.3 % after the redistribution, while the stomach contents of the named Gadidae (<em>Gadus morhua</em>, <em>Melanogrammus aeglefinus</em>, <em>Merlangius merlangus</em>, <em>Trisopterus esmarkii</em>) have increased shlightly.</p>
<p>The next calls to redist_unidentified_prey_sp() show how to widen the selection of data to make the allocation key from at sample level (previous example), to all samples within the rectangle, all samples within the roundfish area, and the full area of all samples. The last call make the allocation key from data by year and half year, whereas the previous calls used data by year and quarter, as that is the used temporal stratification use in data.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by sub_area (rectangel)                                                         </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span>stratum_sub_area,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 63,  found: 31   un-allocated: 32</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 222,  found: 83   un-allocated: 139</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># by area (=roundfish area)                                                               </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span>stratum_area,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 32,  found: 28   un-allocated: 4</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 139,  found: 118   un-allocated: 21</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  unknown  Records to be dis.: 5,  found: 4   un-allocated: 1</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># all areas                                                               </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 4,  found: 4   un-allocated: 0</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 21,  found: 14   un-allocated: 7</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  unknown  Records to be dis.: 1,  found: 1   un-allocated: 0</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># all areas and half-year (dist_time is changed)                                                             </span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span><span class="fu">paste</span>(year,<span class="fu">ifelse</span>(quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="st">&#39;S1&#39;</span>,<span class="st">&#39;S2&#39;</span>)),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,<span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 0</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 7,  found: 6   un-allocated: 1</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  unknown  Records to be dis.: 0</span></span></code></pre></div>
<p>There is still one occurrence of “Gadidae” that cannot be redistributed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">subset</span>(<span class="fu">as.data.frame</span>(s),prey_name<span class="sc">==</span><span class="st">&#39;Gadidae&#39;</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   dataset country ship rectangle area year quarter month day station haul</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      NS     GFR WAL2      43F5    7 1991       2     5  24     446  446</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                           sample_id    pred_name  pred_nodc   box17</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Gadus morhua_GFR_y:91_q:2_ID:1109 Gadus morhua 8791030402 outside</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pred_size_class pred_size n_tot pred_l_mean   fish_id stratum_time</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1               4 0150-0199    11         175 0150-0199      1991-Q2</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   stratum_area stratum_sub_area prey_name digest prey_size_class prey_size</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1          R-7             43F5   Gadidae      1               0 9999-9999</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     prey_w prey_l_mean   prey_n</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 6.046668          38 1.166667</span></span></code></pre></div>
<p>The problem seems to be a small cod (0150-0199) which has eaten “Gadidae”. Other cod within the same size class have not eaten named Gadidae (e.g. cod or whiting), so it is not possible to make a distribution key for the that size class. In this case this Gadidae is turned into “other food” in the next call to redist_unidentified_prey_sp().</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the same as above, but unallocated remains to &quot;other food&quot;.                                                             </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_sp</span>(s,<span class="at">dist_time=</span><span class="fu">paste</span>(year,<span class="fu">ifelse</span>(quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="st">&#39;S1&#39;</span>,<span class="st">&#39;S2&#39;</span>)),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,<span class="at">dist_pred_size=</span>pred_size, <span class="at">do_only=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">from_to_species=</span>from_to,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">by_prey_size=</span><span class="cn">FALSE</span>,<span class="at">remains_to_other =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Clupeidae  Records to be dis.: 0</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  Gadidae  Records to be dis.: 1,  found: 0   as other: 1</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Redist.  unknown  Records to be dis.: 0</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>,<span class="at">use_criteria=</span><span class="cn">FALSE</span>,<span class="at">rel_weight=</span><span class="cn">TRUE</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">label=</span><span class="st">&quot;After reallocation of unindentified preys&quot;</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  After reallocation of unindentified preys </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                    0.5       0.9       0.6       0.4       0.1</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.2       5.7</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.6       0.3       0.1</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.8       1.2       1.6</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.5       2.5       4.2</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     0.4       1.5       9.7      13.2       4.1</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.4        NA        NA</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii           0.1       1.4       5.9       2.1       0.0</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            1.1       4.7      22.3      21.9      15.9</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                     NA        NA        NA       0.5   2.9</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                2.4        NA        NA       0.8  12.1</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.2       0.1       0.5       0.0   2.0</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus       0.5       0.2       0.2       0.2   5.8</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           4.1       1.3        NA       1.1  15.7</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA      14.9  14.9</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Other fish                     2.2       2.4        NA       2.3  35.8</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus               NA        NA        NA       0.0   0.7</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA       0.4  10.1</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            9.3       3.9       0.6      20.2 100.0</span></span></code></pre></div>
<p>After the allocation af preys, data now includes the named species (for later use in models) and the groups “other” and “othe fish” that wil connverted to “other food” later. There are however stil named preys with unknown size (9999-9999) taha need to allocated to known sizes.</p>
</div>
<div id="assigning-size-classes-where-missing" class="section level3">
<h3>Assigning size classes where missing</h3>
<p>The assigning of size classes where missing is done in a similar way as the allocation of species name to partly idenstified prey items, but using the function redist_unidentifed_prey_lengths(). This function only works for the species provided by sel_preys in the control object</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a very complex way of getting a list of prey names!</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>keep_prey <span class="ot">&lt;-</span>(<span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;species_info.csv&quot;</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col_types =</span> <span class="fu">cols</span>())  <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(prey_sp)  <span class="sc">%&gt;%</span> <span class="fu">select</span>(species) <span class="sc">%&gt;%</span> <span class="fu">unique</span>())<span class="sc">$</span>species</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>keep_prey <span class="co">#input is just vector of prey names</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Gadus morhua&quot;             &quot;Merlangius merlangus&quot;    </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] &quot;Melanogrammus aeglefinus&quot; &quot;Clupea harengus&quot;         </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] &quot;Ammodytidae&quot;              &quot;Trisopterus esmarkii&quot;    </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] &quot;Sprattus sprattus&quot;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">edit_control</span>(s,<span class="at">sel_preys=</span>keep_prey)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sel_preys type; vector TRUE</span></span></code></pre></div>
<p>We can now do the re-allocation of mising size classes.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by statum_area (=roundfish area) </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_lengths</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span>stratum_area,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist_pred_size=</span>pred_size,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">remains_to_other =</span> <span class="cn">FALSE</span>, <span class="co"># do not add records with missing length allocation to &quot;other food&quot;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">others_to_other=</span><span class="cn">TRUE</span>      <span class="co"># do add other species that selected prey species to &quot;other food&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Records to be distributed: 860 ,  found: 799   Un-allocated: 61</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># within all areas                                                     </span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_lengths</span>(s,<span class="at">dist_time=</span>stratum_time,<span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist_pred_size=</span>pred_size,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Records to be distributed: 61 ,  found: 55   Un-allocated: 6</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  within all areas, and year (ignoring quarter)                                                   </span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_lengths</span>(<span class="at">s=</span>s,<span class="at">dist_time=</span><span class="fu">substr</span>(stratum_time,<span class="dv">1</span>,<span class="dv">4</span>),<span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist_pred_size=</span>pred_size,<span class="at">remains_to_other =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Records to be distributed: 6 ,  found: 3   Un-allocated: 3</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co"># as above, but with conversion of unallocated into &quot;other&quot;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">redist_unidentified_prey_lengths</span>(<span class="at">s=</span>s,<span class="at">dist_time=</span><span class="fu">substr</span>(stratum_time,<span class="dv">1</span>,<span class="dv">4</span>),<span class="at">dist_area=</span><span class="st">&#39;All&#39;</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">dist_pred_size=</span>pred_size,<span class="at">remains_to_other =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prey size will be allocated for species: Gadus morhua ,  Merlangius merlangus ,  Melanogrammus aeglefinus ,  Clupea harengus ,  Ammodytidae ,  Trisopterus esmarkii ,  Sprattus sprattus ,  </span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Records to be distributed: 3 ,  found: 0   Un-allocated: 3</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="fu">do_detailed_output</span>(s, <span class="at">by_sample_id=</span><span class="cn">TRUE</span>,<span class="at">to_screen=</span><span class="cn">TRUE</span>,<span class="at">use_criteria=</span><span class="cn">FALSE</span>,<span class="at">rel_weight=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0050-0069 0070-0099 0100-0149 0150-0199 0200-0249</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                    0.6       1.1       0.7       0.4       0.1</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                0.0       0.0       0.9       2.4       6.1</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.1       0.3       0.6       0.3       0.1</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus        NA       0.2       1.9       1.2       1.6</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           0.0       0.1       2.6       2.7       4.6</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA        NA        NA</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus              0.0       0.3       0.4        NA        NA</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii           0.1       1.5       6.2       2.2       0.0</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            0.8       3.5      13.4       9.3      12.6</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          0250-0299 0300-0399 0400-0499 9999-9999   all</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Ammodytidae                     NA        NA        NA        NA   2.9</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Clupea harengus                2.7        NA        NA        NA  12.1</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Gadus morhua                   0.2       0.1       0.5        NA   2.0</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Melanogrammus aeglefinus       0.5       0.2       0.2        NA   5.8</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Merlangius merlangus           4.3       1.4        NA        NA  15.7</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other                           NA        NA        NA      50.7  50.7</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sprattus sprattus               NA        NA        NA        NA   0.7</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trisopterus esmarkii            NA        NA        NA        NA  10.1</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; all                            7.5       1.7       0.6      50.7 100.0</span></span></code></pre></div>
<p>There were a very small amount of <em>Merlangius merlangus</em> that could not be allocated, and these are allocated into “other” in the last function call. The prey species are now the selected ones and “other”.</p>
</div>
<div id="calculating-population-diet" class="section level3">
<h3>Calculating population diet</h3>
<p>The average diet should basically be calculated as a stratified mean of the individual stomach content samples, weighted by strata abundances (e.g survey cpue indices) of the predator and strata areas. FishStomachs uses three strata (ii-iv) in the calculation of population diet:</p>
<ol style="list-style-type: lower-roman">
<li>Sample level. stomach from the same sample (i.e. location and time). The average stomach contents at that level have been calculated in the previous examples</li>
<li>Sub-area level. For this example, ICES statistical rectangles have been used as sub-area strata. The average diet within a sub-area is in this example calculated as a simple mean.</li>
<li>Area level. ICES roundfish areas are used for area strata. Average diet within an area is calculated a as weighted mean, weighted by the predator survey cpue by the sub-area (ICES rectangel)</li>
<li>Population. The average population diet is calculated from diet by are weighted by extend of the ambient area of the area (e.g. number of ICES rectangles within a roundfish area)</li>
</ol>
<p>The method for calculating the population is specified with options in the control object as shown below.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>s<span class="ot">&lt;-</span><span class="fu">edit_control</span>(s,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">calc_sub_strata=</span><span class="fu">list</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># transform into relative weight before data are compiled</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">relative_weight=</span><span class="cn">FALSE</span>,      </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>          <span class="co"># use number of stomach in the sample as weighting factor</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting_factor=</span><span class="fu">expression</span>(n_tot),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>          <span class="co"># set file to NA when weighting_factor is given</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">weigthing_factor_file=</span><span class="cn">NA</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">calc_strata=</span><span class="fu">list</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">relative_weight=</span><span class="cn">FALSE</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting_factor=</span><span class="fu">expression</span>(<span class="fu">sqrt</span>(mean_cpue)),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">weigthing_factor_file=</span><span class="cn">NA</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">calc_total=</span><span class="fu">list</span>(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">relative_weight=</span><span class="cn">FALSE</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>          <span class="co"># set to NA when input is provided in a file</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">weighting_factor=</span><span class="cn">NA</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>          <span class="co"># use data from a specified file (in thos case, a file provided by the FishStomachs)</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">weigthing_factor_file=</span><span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;weighting_total.csv&quot;</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_sub_strata type; list TRUE </span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_strata type; list TRUE </span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_total type; list TRUE</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">attr</span>(s,<span class="st">&quot;control&quot;</span>),<span class="at">show=</span><span class="st">&#39;calc_diet&#39;</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: calc_diet </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sel_preys:  chr [1:7] &quot;Gadus morhua&quot; &quot;Merlangius merlangus&quot; &quot;Melanogrammus aeglefinus&quot; ...</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min_prey_length:  int 50</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_sub_strata: List of 3</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     :  expression(n_tot)</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: logi NA</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_strata: List of 3</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     :  expression(sqrt(mean_cpue))</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: logi NA</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_total: List of 3</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     : logi NA</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: chr &quot;C:/Users/movi/AppData/Local/Temp/RtmpeYTU6m/temp_libpath364458cae67/FishStomachs/extdata/weighting_total.csv&quot;</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co"># informtion from the group constants in the control obsject is also used.</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">attr</span>(s,<span class="st">&quot;control&quot;</span>),<span class="at">show=</span><span class="st">&#39;constants&#39;</span>)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: constants </span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max_l:  int 9999</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mis_l:  int 9999</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other:  chr &quot;other&quot;</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mis_size_class:  int 0</span></span></code></pre></div>
<p>For each of the three strata, it must be specified whether the absolute or relative weight of the diet by strata should be used to calculate the weighted mean. The weighting factor for the for the weighted mean must either be given as an expression wit R codes for variables within the STOMobs object or provided as input from a csv file. In this case the weighting factor used to calculate average diet per sub-area is the number of stomachs (n-tot) within each sample. The average diet at strata level uses the mean cpue variable within the STOMobs ojcet. Finally the population diet is calculated from average diet by strata weighted by input values from a file. This file must contain a weighting factor ( w_fac_area) for each combination of predator name (pred_name), temporal strata (stratum_time), predator size class (pred_size) and name of the area (stratum_area). If input from files are used, it is possible to select combinations of areas and sub-areas that should be included, as only stomach data that have a match in weighing files are used in the calculation.</p>
<p>The input files for stratification can be made from a call to make_template_strata_weighting() using data and its control object. The call makes a csv file (if write_CSV=TRUE) and return a data set with the template for stratification at the strata level specified.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make_template_strata_weighting</span>(s,<span class="at">strata=</span><span class="fu">c</span>(<span class="st">&#39;sub_strata&#39;</span>,<span class="st">&#39;strata&#39;</span>,<span class="st">&#39;total&#39;</span>)[<span class="dv">3</span>],<span class="at">write_CSV=</span><span class="cn">FALSE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to show the contents of stratification file as created above (with write_CSV=TRUE)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>( <span class="at">package =</span> <span class="st">&quot;FishStomachs&quot;</span>),<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;weighting_total.csv&quot;</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Rows: 239 Columns: 5</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -- Column specification --------------------------------------------------------</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Delimiter: &quot;,&quot;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; chr (4): pred_name, stratum_time, pred_size, stratum_area</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dbl (1): w_fac_area</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; i Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; i Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 239 x 5</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    pred_name    stratum_time pred_size stratum_area w_fac_area</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 Gadus morhua 1991-Q1      0200-0249 R-7                   1</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 Gadus morhua 1991-Q1      0200-0249 R-6                   1</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 Gadus morhua 1991-Q1      0250-0299 R-4                   1</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 Gadus morhua 1991-Q1      0250-0299 R-6                   1</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 Gadus morhua 1991-Q1      0100-0149 R-7                   1</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 Gadus morhua 1991-Q1      0300-0399 R-4                   1</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 Gadus morhua 1991-Q1      0300-0399 R-6                   1</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 Gadus morhua 1991-Q1      0100-0149 R-6                   1</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 Gadus morhua 1991-Q1      0300-0399 R-7                   1</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 Gadus morhua 1991-Q1      0300-0399 R-2                   1</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 229 more rows</span></span></code></pre></div>
<p>Now it just to call the estimate population diet.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">attr</span>(s,<span class="st">&quot;control&quot;</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: general </span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; name:  chr &quot;Test cod&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stomach_format:   expression(system.file(&quot;stomach_format.csv&quot;, package = &quot;FishStomachs&quot;))</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: data_used </span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; stomach_dir:  chr &quot;C:/Users/movi/AppData/Local/Temp/RtmpeYTU6m/temp_libpath364458cae67/FishStomachs/extdata&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dataSets:  chr [1:2] &quot;cod_stom_1991.csv&quot; &quot;cod_stom_1991.csv&quot;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; years:  int 1991</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; quarters:  int [1:4] 1 2 3 4</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; predators:  chr &quot;Gadus morhua&quot;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: stratification </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_area_exp:   expression(paste(&quot;R&quot;, area, sep = &quot;-&quot;))</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_sub_area_exp:   expression(rectangle)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_time_exp:   expression(paste0(year, &quot;-Q&quot;, quarter))</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_year_back:   expression(as.numeric(substr(stratum_time, 1, 4)))</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; strata_quarter_back:   expression(as.numeric(substr(stratum_time, 7, 8)))</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: calc_diet </span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; sel_preys:  chr [1:7] &quot;Gadus morhua&quot; &quot;Merlangius merlangus&quot; &quot;Melanogrammus aeglefinus&quot; ...</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min_prey_length:  int 50</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_sub_strata: List of 3</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     :  expression(n_tot)</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: logi NA</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_strata: List of 3</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     :  expression(sqrt(mean_cpue))</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: logi NA</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; calc_total: List of 3</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ relative_weight      : logi FALSE</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weighting_factor     : logi NA</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ weigthing_factor_file: chr &quot;C:/Users/movi/AppData/Local/Temp/RtmpeYTU6m/temp_libpath364458cae67/FishStomachs/extdata/weighting_total.csv&quot;</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: model_output </span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; model_options: List of 8</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ minimum_stom           : num 1e-04</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ insert_mid_value       : logi TRUE</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ mid_value              : num 1e-04</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ insert_tails           : logi FALSE</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ tail_value             : num 1e-04</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ first_age              : int 0</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ first_quarter_first_age: int 3</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ minimum_alk            : num 1e-04</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: constants </span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max_l:  int 9999</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mis_l:  int 9999</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; other:  chr &quot;other&quot;</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; mis_size_class:  int 0</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: test_output </span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; do_test_output:  logi FALSE</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; do_test_output_file:  logi FALSE</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; tst_file:  chr &quot;my_detailed.file&quot;</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #### group: detailed_test_output </span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; detailed_tst_output:  logi TRUE</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; detailed_tst_file:  chr &quot;cod_sample.txt&quot;</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; detailed_tst_criteria: List of 4</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ pred_name:  expression(pred_name == &quot;Gadus morhua&quot;)</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ year     :  expression(year == 1991)</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ quarter  :  expression(quarter == 1)</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ sample_id:  expression(sample_id %in% c(&quot;Gadus morhua_FRA_y:91_q:1_ID:1008&quot;, &quot;Gadus morhua_SCO_y:91_q:1_ID:582&quot;))</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">calc_population_stom</span>(s)</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Using weighting factors from file C:/Users/movi/AppData/Local/Temp/RtmpeYTU6m/temp_libpath364458cae67/FishStomachs/extdata/weighting_total.csv</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Object of class &#39;STOMdiet&#39;</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ===========================</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number stomachs: 9660 </span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Predators: Gadus morhua </span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of prey names: 8 </span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Prey names:Ammodytidae; Clupea harengus; Gadus morhua; Melanogrammus aeglefinus; </span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Merlangius merlangus; Sprattus sprattus; Trisopterus esmarkii; other; </span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Temporal strata: 1991-Q1;  1991-Q2;  1991-Q3;  1991-Q4;</span></span></code></pre></div>
<p>The population diet is store in an object of class STOMdiet - more details in the next example.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
